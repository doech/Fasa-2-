import javax.swing.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.image.BufferedImage;
import javax.imageio.ImageIO;
import java.io.File;
import java.io.IOException;

public class MainGUI {
    private Mapa mapa; //instancia de mapa para gestionar peligros
    private Usuario usuario; //instancia usuario para gestionar puntuaciones a futuro
    private JPanel mapaPanel;
    private BufferedImage mapaImage; //se utilizara una imagen como mapa para poder mostrarlo al usuario en el sitio

    /**
     * constructor de la clase MainGUI
     */

    public MainGUI() {
        mapa = new Mapa(); // inicializa el mapa
        usuario = new Usuario("Juan", "juan@example.com"); // crea usuario automaticamente

        // cargar la imagen del mapa
        try {
            mapaImage = ImageIO.read(new File("mapa_zona16.png")); // Asegúrate de que la imagen esté en el directorio correcto
        } catch (IOException e) {
            e.printStackTrace();
        }

        JFrame frame = new JFrame("Gestión de Peligros");
        frame.setSize(400, 300);
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setLayout(null);

        //panel para el mapa
        mapaPanel = new JPanel() {
            @Override
            protected void paintComponent(Graphics g) {
                super.paintComponent(g);
                dibujarMapa(g); // Llamar al método para dibujar el mapa
            }
        };
        mapaPanel.setPreferredSize(new Dimension(800, 400));
        frame.add(mapaPanel, BorderLayout.CENTER);



        //editar lugar botones

        JButton btnReportar = new JButton("Reportar Peligro");
        btnReportar.setBounds(100, 70, 200, 30);
        frame.add(btnReportar);

        JButton btnMostrar = new JButton("Mostrar Peligros");
        btnMostrar.setBounds(100, 120, 200, 30);
        frame.add(btnMostrar);

        JButton btnGuardar = new JButton("Guardar Peligros en CSV");
        btnGuardar.setBounds(100, 170, 200, 30);
        frame.add(btnGuardar);

        //reportar peligro
        btnReportar.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                String tipoPeligro = JOptionPane.showInputDialog("Ingrese el tipo de peligro:");
                String descripcionPeligro = JOptionPane.showInputDialog("Ingrese la descripción del peligro:");
                double latitud = Double.parseDouble(JOptionPane.showInputDialog("Ingrese la latitud:"));
                double longitud = Double.parseDouble(JOptionPane.showInputDialog("Ingrese la longitud:"));
                int gravedad = Integer.parseInt(JOptionPane.showInputDialog("Ingrese la gravedad (1-5):"));
                String carril = JOptionPane.showInputDialog("Ingrese el carril (izquierdo/derecho):");

                Peligro peligro = new Peligro(tipoPeligro, descripcionPeligro, latitud, longitud, gravedad, carril);
                mapa.agregarPeligro(peligro);
                usuario.agregarPuntos(10); // Agrega puntos al usuario

                JOptionPane.showMessageDialog(frame, "Peligro reportado exitosamente.");
            }
        });
    //mostrar peligros reportados
    btnMostrar.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                StringBuilder peligrosList = new StringBuilder("Peligros reportados:\n");
                for (Peligro p : mapa.getPeligros()) {
                    peligrosList.append(p.getTipo()).append(" - ").append(p.getDescripcion()).append("\n");
                }
                JOptionPane.showMessageDialog(frame, peligrosList.toString());
            }
        });

    // guardar en csv
    btnGuardar.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                mapa.guardarPeligrosCSV("peligros.csv");
                JOptionPane.showMessageDialog(frame, "Peligros guardados en CSV.");
            }
        });

    frame.setVisible(true); //muestra frame (ventana)
}
    /**
     * Método principal para iniciar la aplicación.
     */
    public static void main(String[] args) {
        new MainGUI(); // creainstancia de MainGUI
    }
}
